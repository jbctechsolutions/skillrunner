# Linear Issues for v1.2.0 MCP Implementation

**Epic:** v1.2.0 - MCP Tool Execution
**Project:** Skillrunner
**Target:** February 2026

Copy each issue below into Linear. Issues are designed for parallel execution by autonomous agents.

---

## Epic Description

**Title:** v1.2.0 - MCP Tool Execution

**Description:**
Enable skills to execute external tools via Model Context Protocol (MCP). This allows skills to write files, run git commands, call APIs - enabling true workflow automation beyond just reading context.

**Value:**
- Skills can DO things, not just read things
- Enables agentic workflows (e.g., "Fix this bug and commit the changes")
- Unlocks automation use cases

**Current State:**
- MCP infrastructure built (domain + adapters, 100% tested)
- No CLI exposure or skill integration

**Success Criteria:**
- CLI commands for MCP server management
- Skills can declare tool requirements
- Permission system for tool execution
- 2+ bundled MCP servers
- Documentation and examples

**Estimated Effort:** 3-4 weeks

---

## Phase 1: MCP CLI Commands (Week 1-2)

### Issue: MCP-1 - Server Management Commands

**Title:** Implement MCP server management CLI commands

**Labels:** `mcp`, `cli`, `week-1`

**Priority:** High

**Estimate:** 3 points (2-3 days)

**Dependencies:** None

**Description:**
Implement CLI commands for managing MCP servers using existing ServerManager infrastructure.

**Commands:**
```bash
sr mcp list-servers
sr mcp start <name>
sr mcp stop <name>
sr mcp restart <name>
sr mcp status <name>
sr mcp logs <name>
```

**Acceptance Criteria:**
- [ ] All 6 commands implemented in `internal/presentation/cli/commands/mcp.go`
- [ ] Commands use existing `ServerManager` from container
- [ ] Proper error handling and user feedback
- [ ] Colors/formatting match existing CLI style
- [ ] Help text and examples for each command
- [ ] Unit tests for command logic
- [ ] Tests pass: `make test`

**Implementation Notes:**
- Create new file: `internal/presentation/cli/commands/mcp.go`
- Register in root.go
- Wire to container's MCP services
- Follow existing command patterns (see ask.go, run.go)

**Test Commands:**
```bash
# After implementation
sr mcp list-servers
sr mcp start filesystem
sr mcp status filesystem
```

---

### Issue: MCP-2 - Tool Discovery Commands

**Title:** Implement MCP tool discovery and testing commands

**Labels:** `mcp`, `cli`, `week-1`

**Priority:** High

**Estimate:** 2 points (2 days)

**Dependencies:** MCP-1 (shares same file)

**Description:**
Add commands to discover and test MCP tools.

**Commands:**
```bash
sr mcp list-tools
sr mcp list-tools --server=filesystem
sr mcp describe-tool <name>
sr mcp call <name> --args='{...}'
```

**Acceptance Criteria:**
- [ ] All 4 commands implemented
- [ ] list-tools shows: name, server, description
- [ ] describe-tool shows full JSON schema
- [ ] call supports JSON argument input
- [ ] Error handling for missing servers/tools
- [ ] Unit tests
- [ ] Tests pass

**Implementation Notes:**
- Add to same mcp.go file
- Use `MCPToolRegistryPort.GetAllTools()`
- Use `MCPServerPort.CallTool()` for testing
- Format JSON schemas readably

**Test Commands:**
```bash
sr mcp list-tools
sr mcp describe-tool mcp__filesystem__read_file
sr mcp call mcp__filesystem__read_file --args='{"path":"test.txt"}'
```

---

### Issue: MCP-3 - Status Command Integration

**Title:** Add MCP section to sr status command

**Labels:** `mcp`, `cli`, `week-1`

**Priority:** Medium

**Estimate:** 1 point (1 day)

**Dependencies:** MCP-1

**Description:**
Show MCP server status in `sr status` output.

**Expected Output:**
```
MCP Servers:
  âœ“ filesystem     Running    3 tools available
  âœ“ git            Running    8 tools available
  âœ— browser        Stopped
```

**Acceptance Criteria:**
- [ ] MCP section added to status output
- [ ] Shows: name, state, tool count
- [ ] Color coding (green=running, red=stopped)
- [ ] `--detailed` shows available tools
- [ ] Handles no servers configured gracefully
- [ ] Unit tests
- [ ] Tests pass

**Implementation Notes:**
- Modify `internal/presentation/cli/commands/status.go`
- Query `ServerManager.ListServers()`
- Add after providers section
- Reuse existing formatting utilities

---

## Phase 2: Skill Tool Integration (Week 3-4)

### Issue: MCP-4 - Skill Domain Model Extension

**Title:** Add tool declarations to skill domain model

**Labels:** `mcp`, `domain`, `week-2`

**Priority:** High

**Estimate:** 2 points (1-2 days)

**Dependencies:** None (pure domain)

**Description:**
Extend skill YAML to support tool declarations.

**YAML Example:**
```yaml
id: file-processor
tools:
  - mcp__filesystem__read_file
  - mcp__filesystem__write_file

phases:
  - id: process
    allow_tools: true
    prompt_template: |
      Process: {{.input}}
```

**Acceptance Criteria:**
- [ ] `Skill` struct has `Tools []string` field
- [ ] `Phase` struct has `AllowTools bool` field
- [ ] YAML parser reads both fields
- [ ] Validation: tools match `mcp__server__tool` format
- [ ] Backward compatible (fields optional)
- [ ] Unit tests
- [ ] Tests pass

**Implementation Notes:**
- Modify `internal/domain/skill/skill.go`
- Update `internal/infrastructure/skills/loader.go`
- Add validation in `Skill.Validate()`

**Files:**
- `internal/domain/skill/skill.go`
- `internal/domain/skill/skill_test.go`
- `internal/infrastructure/skills/loader.go`
- `internal/infrastructure/skills/loader_test.go`

---

### Issue: MCP-5 - Tool Permission System

**Title:** Implement tool execution permission prompts

**Labels:** `mcp`, `security`, `week-2`

**Priority:** High

**Estimate:** 3 points (2-3 days)

**Dependencies:** MCP-4 (needs skill.Tools)

**Description:**
Create permission system for tool execution (similar to file permissions).

**Permission Prompt:**
```
ðŸ”§ Tool Permission Request
The skill wants to use 2 tool(s):
  1. filesystem__read_file - Read files
  2. filesystem__write_file - Write files

Allow tool execution? [Y/n/individual/show]
```

**Acceptance Criteria:**
- [ ] Permission prompt before skill execution
- [ ] Four modes: Y, n, individual, show
- [ ] Auto-approve via `-y` flag
- [ ] Shows tool descriptions from MCP
- [ ] Denying aborts with clear error
- [ ] Unit tests with stdin mocking
- [ ] Tests pass

**Implementation Notes:**
- Create `internal/infrastructure/context/tool_permission.go`
- Pattern: copy from `permission.go` (file permissions)
- Integrate into workflow executor
- Add `-y` flag to run and ask commands

**Files:**
- `internal/infrastructure/context/tool_permission.go` (new)
- `internal/infrastructure/context/tool_permission_test.go` (new)
- `internal/application/workflow/executor.go` (add check)
- `internal/presentation/cli/commands/run.go` (add -y)
- `internal/presentation/cli/commands/ask.go` (add -y)

---

### Issue: MCP-6 - Provider Tool Integration

**Title:** Pass tools to provider and handle tool calls

**Labels:** `mcp`, `provider`, `week-3`

**Priority:** High

**Estimate:** 5 points (3-4 days)

**Dependencies:** MCP-4, MCP-5

**Description:**
Integrate MCP tools with provider (Anthropic) for function calling.

**Flow:**
1. Fetch tool definitions from MCP registry
2. Convert to provider format
3. Pass in CompletionRequest.Tools
4. Handle tool_use blocks in response
5. Execute via MCP
6. Feed results back to provider

**Acceptance Criteria:**
- [ ] Executor fetches tools from MCP registry
- [ ] Tools converted using existing converter
- [ ] Tools passed in CompletionRequest
- [ ] Anthropic adapter handles tool calls
- [ ] Tool execution via MCPToolRegistryPort
- [ ] Results fed back for continuation
- [ ] Unit tests
- [ ] Integration test with real API
- [ ] Tests pass

**Implementation Notes:**
- Modify `internal/application/workflow/phase_executor.go`
- Modify `internal/application/workflow/streaming_phase_executor.go`
- Modify `internal/adapters/provider/anthropic/client.go`
- Use existing `tool_converter.go`

**Files:**
- `internal/application/workflow/phase_executor.go`
- `internal/application/workflow/streaming_phase_executor.go`
- `internal/adapters/provider/anthropic/client.go`
- `internal/adapters/provider/anthropic/streaming.go`

---

### Issue: MCP-7 - Tool Call Streaming Display

**Title:** Show tool calls in streaming output

**Labels:** `mcp`, `ui`, `week-3`

**Priority:** Medium

**Estimate:** 2 points (2 days)

**Dependencies:** MCP-6 (tool calling must work)

**Description:**
Display tool calls in real-time during streaming execution.

**Expected Output:**
```
Phase: Process
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Processing...

ðŸ”§ Calling: filesystem__read_file
   Args: {"path": "data.json"}
   âœ“ Success (1.2 KB)

Transforming...

ðŸ”§ Calling: filesystem__write_file
   Args: {"path": "output.json"}
   âœ“ Success
```

**Acceptance Criteria:**
- [ ] Tool calls shown during streaming
- [ ] Tool arguments displayed (truncated)
- [ ] Results summarized
- [ ] Errors shown clearly
- [ ] Colors match existing output
- [ ] Unit tests
- [ ] Tests pass

**Implementation Notes:**
- Extend `internal/presentation/cli/output/streaming.go`
- Add tool event handling to callback
- Format tool calls inline
- Use existing color scheme

**Files:**
- `internal/presentation/cli/output/streaming.go`
- `internal/presentation/cli/output/streaming_test.go`

---

## Phase 3: Bundled Servers & Examples (Week 5)

### Issue: MCP-8 - Default Server Configurations

**Title:** Create default MCP server configurations

**Labels:** `mcp`, `config`, `week-4`

**Priority:** High

**Estimate:** 2 points (1-2 days)

**Dependencies:** None

**Description:**
Configure filesystem and git MCP servers by default.

**Config File:** `~/.skillrunner/mcp_servers.json`
```json
{
  "filesystem": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-filesystem", "${HOME}"]
  },
  "git": {
    "command": "npx",
    "args": ["-y", "@modelcontextprotocol/server-git"]
  }
}
```

**Acceptance Criteria:**
- [ ] Default config created by `sr init`
- [ ] Supports ${HOME} and ${PWD} expansion
- [ ] Validation on load
- [ ] Instructions if npx missing
- [ ] Unit tests
- [ ] Tests pass

**Implementation Notes:**
- Create `internal/infrastructure/config/mcp_defaults.go`
- Modify `sr init` command
- Add to config loader

**Files:**
- `internal/infrastructure/config/mcp_defaults.go` (new)
- `internal/presentation/cli/commands/init.go` (modify)
- `configs/mcp_servers.example.json` (new)

---

### Issue: MCP-9 - Example Skills

**Title:** Create example skills using MCP tools

**Labels:** `mcp`, `skills`, `documentation`, `week-4`

**Priority:** Medium

**Estimate:** 2 points (1-2 days)

**Dependencies:** MCP-4, MCP-6, MCP-8

**Description:**
Create 3 example skills demonstrating tool usage.

**Skills:**
1. **file-edit** - Edit files using read/write
2. **git-commit** - Generate and commit changes
3. **api-fetch** - Fetch web data and save

**Acceptance Criteria:**
- [ ] 3 skills created in `skills/`
- [ ] All skills use tools correctly
- [ ] Clear comments in YAML
- [ ] Tested end-to-end manually
- [ ] Added to README
- [ ] Documented in skills-guide.md

**Files:**
- `skills/file-edit.yaml` (new)
- `skills/git-commit.yaml` (new)
- `skills/api-fetch.yaml` (new)
- `README.md` (update)
- `docs/skills-guide.md` (update)

**Test Commands:**
```bash
sr run file-edit "Add a header to README.md"
sr run git-commit "Review changes and commit"
```

---

### Issue: MCP-10 - MCP Documentation

**Title:** Write comprehensive MCP documentation

**Labels:** `mcp`, `documentation`, `week-4`

**Priority:** High

**Estimate:** 2 points (1-2 days)

**Dependencies:** All other MCP issues (document final state)

**Description:**
Create complete MCP guide covering all features.

**Sections:**
1. MCP Overview
2. Server Management
3. Using Tools in Skills
4. Available Servers
5. Creating Custom Servers
6. Troubleshooting

**Acceptance Criteria:**
- [ ] `docs/mcp-guide.md` created
- [ ] All sections complete
- [ ] Code examples for each feature
- [ ] Screenshots of prompts
- [ ] Links to official MCP docs
- [ ] Troubleshooting section
- [ ] Added to docs index

**Files:**
- `docs/mcp-guide.md` (new, ~500 lines)
- `docs/README.md` (add to index)
- `README.md` (add MCP to features)

---

## Testing & Quality

### Issue: MCP-11 - Integration Tests

**Title:** MCP end-to-end integration tests

**Labels:** `mcp`, `testing`, `week-4`

**Priority:** High

**Estimate:** 3 points (2-3 days)

**Dependencies:** MCP-6, MCP-8

**Description:**
Create integration tests with real MCP servers.

**Test Coverage:**
- Server lifecycle (start/stop)
- Tool discovery
- Skill execution with tools
- Permission system
- Error handling

**Acceptance Criteria:**
- [ ] Integration test file created
- [ ] Tests with real filesystem server
- [ ] Tests with real git server
- [ ] Tests error scenarios
- [ ] All tests pass
- [ ] CI runs integration tests

**Files:**
- `tests/integration/mcp_test.go` (new)
- `.github/workflows/ci.yml` (add integration tests)

---

## Release

### Issue: MCP-12 - v1.2.0 Release Preparation

**Title:** Prepare v1.2.0 MCP release

**Labels:** `release`, `week-5`

**Priority:** High

**Estimate:** 2 points (1-2 days)

**Dependencies:** All MCP issues complete

**Description:**
Final testing, documentation, and release preparation.

**Checklist:**
- [ ] All MCP issues merged
- [ ] CHANGELOG.md updated
- [ ] README.md updated
- [ ] All tests passing (unit + integration)
- [ ] Manual testing checklist complete
- [ ] Security review done
- [ ] Performance tested
- [ ] Create release branch
- [ ] Tag v1.2.0
- [ ] Push to GitHub
- [ ] Create GitHub release
- [ ] Update Linear roadmap

**Manual Testing:**
- Fresh install
- sr init creates MCP config
- Start servers
- Run example skills
- Test all permission modes
- Test error handling

---

## Issue Import Instructions

**For Linear:**
1. Create Epic: "v1.2.0 - MCP Tool Execution"
2. For each issue (MCP-1 through MCP-12):
   - Create new issue
   - Copy title
   - Set labels
   - Set priority
   - Set estimate
   - Add dependencies
   - Copy full description

**For GitHub Issues:**
- Use issue templates
- Tag with `v1.2.0` milestone
- Add `mcp` label to all

**For Autonomous Agents:**
- Each issue is self-contained
- Clear acceptance criteria
- Implementation notes provided
- Test commands included
- All files specified

---

## Parallel Execution Plan

**Week 1:**
- Agent 1: MCP-1 (Server commands)
- Agent 2: MCP-2 (Tool commands)
- Agent 3: MCP-3 (Status integration)
- Agent 4: MCP-8 (Default configs)

**Week 2:**
- Agent 1: MCP-4 (Domain model)
- Agent 2: MCP-5 (Permissions)
- Agent 3: MCP-9 (Example skills)
- Agent 4: MCP-10 (Documentation)

**Week 3:**
- Agent 1: MCP-6 (Provider integration)
- Agent 2: MCP-7 (Streaming display)
- Agent 3: MCP-11 (Integration tests)

**Week 4:**
- All agents: Testing & bug fixes
- Lead: MCP-12 (Release prep)

Total parallel capacity: 4 agents working simultaneously
Critical path: MCP-4 â†’ MCP-5 â†’ MCP-6 â†’ MCP-7 (10-11 days)

---

**Full Implementation Plan:** See `docs/v1.2.0-mcp-implementation-plan.md` (660 lines)
